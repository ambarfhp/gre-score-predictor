<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GRE Score Predictor</title>
  <!-- Google Fonts (Poppins) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link 
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" 
    rel="stylesheet"
  >
  <style>
    /* Base Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #333;
      display: flex;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    /* Container for everything */
    .container {
      width: 100%;
      max-width: 700px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    /* Header "card" */
    .header-card {
      background: #ffffff;
      border-radius: 8px;
      width: 100%;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      padding: 20px;
      text-align: center;
    }
    .header-card .logo {
      max-width: 80px; /* Adjust as needed */
      margin-bottom: 10px;
    }
    .header-card h1 {
      font-size: 1.8rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }
    .header-card p {
      font-size: 1rem;
      color: #555;
      font-weight: 600; /* Bold the subtitle */
    }

    /* The main card for each GRE section */
    .card {
      border-radius: 10px;
      width: 100%;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.1);
      position: relative;
      min-height: 320px;
    }
    .card h2 {
      font-size: 1.3rem;
      font-weight: 500;
      text-align: center;
      margin-bottom: 20px;
      color: #444;
    }

    /* Color-coding for the cards */
    .quant-card {
      background: linear-gradient(135deg, #e0ffd6 0%, #f3ffe8 100%);
    }
    .verbal-card {
      background: linear-gradient(135deg, #d6f0ff 0%, #e8f9ff 100%);
    }

    /* 3 columns:
       1 => vertical slider for Section 1
       2 => vertical slider for Section 2
       3 => stacked circles (score + percentile)
    */
    .three-col-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 150px; 
      column-gap: 30px;
      align-items: start;
      justify-items: center;
    }

    /* Vertical slider container */
    .vertical-slider-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .vertical-slider-label {
      font-size: 0.9rem;
      color: #444;
      text-align: center;
      line-height: 1.2;
    }
    .vertical-slider-wrapper {
      position: relative;
      width: 60px;  
      height: 200px; 
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* The slider itself */
    .vertical-slider {
      -webkit-appearance: none;
      position: absolute;
      width: 200px;  
      height: 60px;  
      transform: rotate(-90deg);
      transform-origin: 100px 30px; 
      outline: none;
      cursor: pointer;
    }
    /* Thin track, 4px wide */
    .vertical-slider::-webkit-slider-runnable-track {
      background: #eee;
      width: 4px;
      height: 60px;
      border-radius: 2px;
      margin: 0 auto;
    }
    /* "Stick" thumb: 12px wide, 50px tall, extends beyond track */
    .vertical-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;  
      height: 50px; 
      border-radius: 3px;
      background: #e63946;
      box-shadow: 0 0 4px rgba(0,0,0,0.2);
      transition: transform 0.2s ease;
      /* No negative margin => extends beyond track on both sides */
      margin-left: 0; 
    }
    .vertical-slider::-webkit-slider-thumb:hover {
      transform: scale(1.05);
    }

    .slider-value {
      font-weight: 600;
      color: #e63946;
      font-size: 1rem;
    }

    /* Circle (score or percentile) */
    .circle-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px; 
      margin-top: 10px;
    }
    .circle-label {
      text-align: center;
      font-size: 0.85rem;
      font-weight: 500;
      color: #444;
      margin-bottom: 5px;
    }
    .circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #e63946;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
      position: relative;
    }
    .circle:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* Bottom message with fixed min-height */
    .card-message {
      width: 100%;
      text-align: center;
      font-size: 0.9rem;
      color: #444;
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #ddd;
      min-height: 40px;
    }

    /* Tooltip */
    .tooltip {
      position: absolute;
      display: none;
      pointer-events: none;
      background: rgba(0,0,0,0.75);
      color: #fff;
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 4px;
      z-index: 999;
      white-space: nowrap;
    }

    /* Responsive */
    @media (max-width: 700px) {
      .three-col-grid {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
      }
      .vertical-slider-wrapper {
        margin-bottom: 10px;
      }
      .circle-col {
        margin-top: 15px;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <!-- Card for the header and subtitle -->
    <div class="header-card">
      <!-- Example logo -->
      <img src="https://i.ibb.co/Z1hgN1T/logo.png" alt="Logo" class="logo" />
      <h1>GRE Score Predictor</h1>
      <p><strong>Move the sliders to indicate how many questions you got wrong in each section.</strong></p>
    </div>

    <!-- Tooltip Element -->
    <div id="tooltip" class="tooltip"></div>

    <!-- Quantitative Card -->
    <div class="card quant-card">
      <h2>Quantitative Reasoning</h2>
      <div class="three-col-grid">
        <!-- Column 1: Vertical Slider for Section 1 -->
        <div class="vertical-slider-container">
          <div class="vertical-slider-wrapper">
            <input 
              type="range"
              id="quantSec1"
              class="vertical-slider"
              min="0"
              max="12"
              value="0"
              oninput="calculateQuant()"
            />
          </div>
          <div class="slider-value" id="quantSec1Val">0 mistakes</div>
          <div class="vertical-slider-label">Section 1<br>0â€“12 incorrect</div>
        </div>

        <!-- Column 2: Vertical Slider for Section 2 -->
        <div class="vertical-slider-container">
          <div class="vertical-slider-wrapper">
            <input 
              type="range"
              id="quantSec2"
              class="vertical-slider"
              min="0"
              max="15"
              value="0"
              oninput="calculateQuant()"
            />
          </div>
          <div class="slider-value" id="quantSec2Val">0 mistakes</div>
          <div class="vertical-slider-label">Section 2<br>0â€“15 incorrect</div>
        </div>

        <!-- Column 3: Score + Percentile Circles stacked -->
        <div class="circle-col">
          <!-- Score Circle -->
          <div>
            <div class="circle-label">Scores</div>
            <div class="circle" id="quantScoreCircle">
              <div id="quantScoreText">Waiting</div>
            </div>
          </div>
          <!-- Percent Circle -->
          <div>
            <div class="circle-label">%ile</div>
            <div class="circle" id="quantPercentCircle">
              <div id="quantPercentText">â€“</div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-message" id="quantMessage"></div>
    </div>

    <!-- Verbal Card -->
    <div class="card verbal-card">
      <h2>Verbal Reasoning</h2>
      <div class="three-col-grid">
        <!-- Column 1: Vertical Slider for Section 1 -->
        <div class="vertical-slider-container">
          <div class="vertical-slider-wrapper">
            <input 
              type="range"
              id="verbSec1"
              class="vertical-slider"
              min="0"
              max="12"
              value="0"
              oninput="calculateVerbal()"
            />
          </div>
          <div class="slider-value" id="verbSec1Val">0 mistakes</div>
          <div class="vertical-slider-label">Section 1<br>0â€“12 incorrect</div>
        </div>

        <!-- Column 2: Vertical Slider for Section 2 -->
        <div class="vertical-slider-container">
          <div class="vertical-slider-wrapper">
            <input 
              type="range"
              id="verbSec2"
              class="vertical-slider"
              min="0"
              max="15"
              value="0"
              oninput="calculateVerbal()"
            />
          </div>
          <div class="slider-value" id="verbSec2Val">0 mistakes</div>
          <div class="vertical-slider-label">Section 2<br>0â€“15 incorrect</div>
        </div>

        <!-- Column 3: Score + Percentile Circles stacked -->
        <div class="circle-col">
          <!-- Score Circle -->
          <div>
            <div class="circle-label">Scores</div>
            <div class="circle" id="verbScoreCircle">
              <div id="verbScoreText">Waiting</div>
            </div>
          </div>
          <!-- Percent Circle -->
          <div>
            <div class="circle-label">%ile</div>
            <div class="circle" id="verbPercentCircle">
              <div id="verbPercentText">â€“</div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-message" id="verbMessage"></div>
    </div>
  </div>

  <script>
    /* ============================
       Global Data & Fetch
    ============================ */
    let quantData = [];
    let verbalData = [];

    fetch('gre-percentile.json')
      .then(response => response.json())
      .then(data => {
        quantData = data.quant;
        verbalData = data.verbal;
      })
      .catch(error => {
        console.error('Error fetching percentile data:', error);
      });

    function clampScore(score) {
      if (score < 130) return 130;
      if (score > 170) return 170;
      return Math.round(score);
    }

    function getPercentile(score, dataArray) {
      const clamped = clampScore(score);
      const entry = dataArray.find(item => item.score === clamped);
      return entry ? entry.percentile : 0;
    }

    /* 
       Fill the slider track with red proportionally 
       as the slider moves up (since more mistakes).
       We'll do this in JS for demonstration.
    */
    function updateSliderFill(slider) {
      const val = parseInt(slider.value, 10);
      const max = parseInt(slider.max, 10);
      const percent = (val / max) * 100;
      // For a vertical slider (rotated), a left-to-right fill in code 
      // appears bottom-to-top visually.
      slider.style.background = 
        `linear-gradient(to right, #e63946 ${percent}%, #eee ${percent}%)`;
    }

    /* ============================
       Quant Calculation
    ============================ */
    function calculateQuant() {
      const sec1Slider = document.getElementById('quantSec1');
      const sec2Slider = document.getElementById('quantSec2');

      // Update slider fill
      updateSliderFill(sec1Slider);
      updateSliderFill(sec2Slider);

      const sec1Val = parseInt(sec1Slider.value, 10);
      const sec2Val = parseInt(sec2Slider.value, 10);

      // Append "mistakes"
      document.getElementById('quantSec1Val').textContent = `${sec1Val} mistakes`;
      document.getElementById('quantSec2Val').textContent = `${sec2Val} mistakes`;

      // Score Calculation
      const raw = 170 - (sec1Val * 2 + sec2Val * 1.4);
      const center = clampScore(raw);
      const lowerScore = clampScore(center - 1.5);
      const upperScore = clampScore(center + 1.5);

      // Score Range
      const scoreRange = (lowerScore === upperScore)
        ? `${lowerScore}`
        : `${lowerScore}â€“${upperScore}`;

      // Percentiles
      const lowerPercent = getPercentile(lowerScore, quantData);
      const upperPercent = getPercentile(upperScore, quantData);

      const scoreCircle = document.getElementById('quantScoreCircle');
      const scoreText = document.getElementById('quantScoreText');
      const percentCircle = document.getElementById('quantPercentCircle');
      const percentText = document.getElementById('quantPercentText');

      // If zero mistakes => Perfect ðŸ‘Œ & 100%ile with green circles
      if (sec1Val === 0 && sec2Val === 0) {
        scoreCircle.style.background = '#4CAF50';
        scoreText.textContent = 'Perfect ðŸ‘Œ';
        percentCircle.style.background = '#4CAF50';
        percentText.textContent = '100%ile';
      } else {
        // Otherwise, revert to red circles
        scoreCircle.style.background = '#e63946';
        percentCircle.style.background = '#e63946';

        // Score circle text
        scoreText.textContent = scoreRange;

        // Percent circle text
        if (lowerPercent === upperPercent) {
          percentText.textContent = `${lowerPercent}%`;
        } else {
          percentText.textContent = `${lowerPercent}%â€“${upperPercent}%`;
        }
      }

      // Inverted logic: how many made fewer mistakes
      const fewerLow = 100 - upperPercent;
      const fewerHigh = 100 - lowerPercent;

      // Bottom Message
      const quantMessage = document.getElementById('quantMessage');
      if (sec1Val === 0 && sec2Val === 0) {
        quantMessage.textContent = '';
      } else if (lowerPercent === upperPercent) {
        quantMessage.textContent =
          `Based on the inputs, understand that ${fewerLow}% of test takers make fewer mistakes than this in Quant.`;
      } else {
        quantMessage.textContent =
          `Based on the inputs, understand that ${fewerLow}% to ${fewerHigh}% of test takers make fewer mistakes than this in Quant.`;
      }
    }

    /* ============================
       Verbal Calculation
    ============================ */
    function calculateVerbal() {
      const sec1Slider = document.getElementById('verbSec1');
      const sec2Slider = document.getElementById('verbSec2');

      // Update slider fill
      updateSliderFill(sec1Slider);
      updateSliderFill(sec2Slider);

      const sec1Val = parseInt(sec1Slider.value, 10);
      const sec2Val = parseInt(sec2Slider.value, 10);

      // Append "mistakes"
      document.getElementById('verbSec1Val').textContent = `${sec1Val} mistakes`;
      document.getElementById('verbSec2Val').textContent = `${sec2Val} mistakes`;

      // Score Calculation
      const raw = 170 - (sec1Val * 1.8 + sec2Val * 1.05);
      const center = clampScore(raw);
      const lowerScore = clampScore(center - 1.5);
      const upperScore = clampScore(center + 1.5);

      // Score Range
      const scoreRange = (lowerScore === upperScore)
        ? `${lowerScore}`
        : `${lowerScore}â€“${upperScore}`;

      // Percentiles
      const lowerPercent = getPercentile(lowerScore, verbalData);
      const upperPercent = getPercentile(upperScore, verbalData);

      const scoreCircle = document.getElementById('verbScoreCircle');
      const scoreText = document.getElementById('verbScoreText');
      const percentCircle = document.getElementById('verbPercentCircle');
      const percentText = document.getElementById('verbPercentText');

      // If zero mistakes => Perfect ðŸ‘Œ & 100%ile with green circles
      if (sec1Val === 0 && sec2Val === 0) {
        scoreCircle.style.background = '#4CAF50';
        scoreText.textContent = 'Perfect ðŸ‘Œ';
        percentCircle.style.background = '#4CAF50';
        percentText.textContent = '100%ile';
      } else {
        // Otherwise, revert to red circles
        scoreCircle.style.background = '#e63946';
        percentCircle.style.background = '#e63946';

        // Score circle text
        scoreText.textContent = scoreRange;

        // Percent circle text
        if (lowerPercent === upperPercent) {
          percentText.textContent = `${lowerPercent}%`;
        } else {
          percentText.textContent = `${lowerPercent}%â€“${upperPercent}%`;
        }
      }

      // Inverted logic: how many made fewer mistakes
      const fewerLow = 100 - upperPercent;
      const fewerHigh = 100 - lowerPercent;

      // Bottom Message
      const verbMessage = document.getElementById('verbMessage');
      if (sec1Val === 0 && sec2Val === 0) {
        verbMessage.textContent = '';
      } else if (lowerPercent === upperPercent) {
        verbMessage.textContent =
          `Based on the inputs, understand that ${fewerLow}% of test takers make fewer mistakes than this in Verbal.`;
      } else {
        verbMessage.textContent =
          `Based on the inputs, understand that ${fewerLow}% to ${fewerHigh}% of test takers make fewer mistakes than this in Verbal.`;
      }
    }

    /* ============================
       Tooltip (Optional)
    ============================ */
    const tooltip = document.createElement('div');
    tooltip.className = 'tooltip';
    document.body.appendChild(tooltip);

    function showTooltip(e, text) {
      tooltip.textContent = text;
      tooltip.style.display = 'block';
      positionTooltip(e);
    }
    function hideTooltip() {
      tooltip.style.display = 'none';
    }
    function positionTooltip(e) {
      const rect = e.target.getBoundingClientRect();
      tooltip.style.left = (rect.left + rect.width / 2) + 'px';
      tooltip.style.top = (rect.top - 35) + 'px';
    }

    // Score Circle Tooltips
    document.getElementById('quantScoreCircle').addEventListener('mouseenter', (e) => {
      showTooltip(e, 'Estimated GRE score range');
    });
    document.getElementById('quantScoreCircle').addEventListener('mouseleave', hideTooltip);

    document.getElementById('verbScoreCircle').addEventListener('mouseenter', (e) => {
      showTooltip(e, 'Estimated GRE score range');
    });
    document.getElementById('verbScoreCircle').addEventListener('mouseleave', hideTooltip);

    // Percent Circle Tooltips
    document.getElementById('quantPercentCircle').addEventListener('mouseenter', (e) => {
      showTooltip(e, 'Approx. percentile or range');
    });
    document.getElementById('quantPercentCircle').addEventListener('mouseleave', hideTooltip);

    document.getElementById('verbPercentCircle').addEventListener('mouseenter', (e) => {
      showTooltip(e, 'Approx. percentile or range');
    });
    document.getElementById('verbPercentCircle').addEventListener('mouseleave', hideTooltip);
  </script>
</body>
</html>
