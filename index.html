<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GRE Score Predictor</title>
  <!-- Google Fonts (Poppins) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link 
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" 
    rel="stylesheet"
  >
  <style>
    /* Base Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .header h1 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .header p {
      font-size: 1rem;
      color: #555;
    }

    /* Card Container */
    .card {
      background: linear-gradient(135deg, #fffcdc 0%, #ffe8c6 100%);
      border-radius: 10px;
      width: 100%;
      max-width: 800px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: space-between;
      position: relative;
      /* Minimum height to prevent shifting */
      min-height: 320px;
    }
    .card h2 {
      font-size: 1.3rem;
      font-weight: 500;
      width: 100%;
      text-align: center;
      margin-bottom: 20px;
      color: #444;
    }

    /* Left section for sliders */
    .left-section {
      flex: 1 1 60%;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    /* Range block */
    .range-block {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .range-row {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .range-label-left {
      flex: 0 0 90px;
      font-weight: 500;
      color: #333;
      margin-right: 10px;
    }
    .slider-wrapper {
      flex: 1;
      margin-right: 10px;
      display: flex;
      align-items: center;
    }
    .slider-wrapper input[type=range] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      background: linear-gradient(to right, #84fab0, #8fd3f4);
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }
    .slider-wrapper input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: #e63946;
      border-radius: 50%;
      cursor: pointer;
      margin-top: -6px;
      box-shadow: 0 0 4px rgba(0,0,0,0.2);
    }
    .slider-value {
      width: 30px;
      text-align: center;
      font-weight: 600;
      color: #e63946;
    }
    .range-label-bottom {
      margin-top: 5px;
      font-size: 0.95rem;
      color: #444;
      font-weight: 500;
    }

    /* Right section for circles */
    .right-section {
      flex: 0 0 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 10px;
      margin-top: 20px;
    }
    .score-circle, .percent-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #e63946;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }

    /* Bottom message with fixed min-height */
    .card-message {
      width: 100%;
      text-align: center;
      font-size: 0.9rem;
      color: #444;
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #ddd;
      min-height: 40px; /* Ensures stable space even if text changes */
    }

    /* Responsive */
    @media (max-width: 600px) {
      .card {
        flex-direction: column;
        align-items: center;
        min-height: auto; /* let it adapt on small screens */
      }
      .range-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .range-label-left {
        margin-bottom: 5px;
      }
      .slider-value {
        margin-top: 5px;
      }
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>GRE Score Predictor</h1>
    <p>Move the sliders to indicate how many questions you got wrong in each section.</p>
  </div>

  <!-- Quantitative Card -->
  <div class="card">
    <h2>Quantitative Reasoning</h2>
    <div class="left-section">
      <!-- Section 1 -->
      <div class="range-block">
        <div class="range-row">
          <div class="range-label-left">Section 1</div>
          <div class="slider-wrapper">
            <input 
              type="range" 
              id="quantSec1" 
              min="0" 
              max="12" 
              value="0" 
              oninput="calculateQuant()"
            />
          </div>
          <div class="slider-value" id="quantSec1Val">0</div>
        </div>
        <div class="range-label-bottom">0–12 incorrect</div>
      </div>
      <!-- Section 2 -->
      <div class="range-block">
        <div class="range-row">
          <div class="range-label-left">Section 2</div>
          <div class="slider-wrapper">
            <input 
              type="range" 
              id="quantSec2" 
              min="0" 
              max="15" 
              value="0" 
              oninput="calculateQuant()"
            />
          </div>
          <div class="slider-value" id="quantSec2Val">0</div>
        </div>
        <div class="range-label-bottom">0–15 incorrect</div>
      </div>
    </div>
    <div class="right-section">
      <div class="score-circle" id="quantScoreCircle">
        <div id="quantScoreText">Waiting</div>
      </div>
      <div class="percent-circle" id="quantPercentCircle">
        <div id="quantPercentText">–</div>
      </div>
    </div>
    <div class="card-message" id="quantMessage"></div>
  </div>

  <!-- Verbal Card -->
  <div class="card">
    <h2>Verbal Reasoning</h2>
    <div class="left-section">
      <!-- Section 1 -->
      <div class="range-block">
        <div class="range-row">
          <div class="range-label-left">Section 1</div>
          <div class="slider-wrapper">
            <input 
              type="range" 
              id="verbSec1" 
              min="0" 
              max="12" 
              value="0" 
              oninput="calculateVerbal()"
            />
          </div>
          <div class="slider-value" id="verbSec1Val">0</div>
        </div>
        <div class="range-label-bottom">0–12 incorrect</div>
      </div>
      <!-- Section 2 -->
      <div class="range-block">
        <div class="range-row">
          <div class="range-label-left">Section 2</div>
          <div class="slider-wrapper">
            <input 
              type="range" 
              id="verbSec2" 
              min="0" 
              max="15" 
              value="0" 
              oninput="calculateVerbal()"
            />
          </div>
          <div class="slider-value" id="verbSec2Val">0</div>
        </div>
        <div class="range-label-bottom">0–15 incorrect</div>
      </div>
    </div>
    <div class="right-section">
      <div class="score-circle" id="verbScoreCircle">
        <div id="verbScoreText">Waiting</div>
      </div>
      <div class="percent-circle" id="verbPercentCircle">
        <div id="verbPercentText">–</div>
      </div>
    </div>
    <div class="card-message" id="verbMessage"></div>
  </div>

  <script>
    /* ============================
       Global Data & Fetch
    ============================ */
    let quantData = [];
    let verbalData = [];

    fetch('gre-percentile.json')
      .then(response => response.json())
      .then(data => {
        quantData = data.quant;
        verbalData = data.verbal;
      })
      .catch(error => {
        console.error('Error fetching percentile data:', error);
      });

    function clampScore(score) {
      if (score < 130) return 130;
      if (score > 170) return 170;
      return Math.round(score);
    }

    function getPercentile(score, dataArray) {
      const clamped = clampScore(score);
      const entry = dataArray.find(item => item.score === clamped);
      return entry ? entry.percentile : 0;
    }

    /* ============================
       Quant Calculation
    ============================ */
    function calculateQuant() {
      const sec1Val = parseFloat(document.getElementById('quantSec1').value);
      const sec2Val = parseFloat(document.getElementById('quantSec2').value);

      // Update displayed values
      document.getElementById('quantSec1Val').textContent = sec1Val;
      document.getElementById('quantSec2Val').textContent = sec2Val;

      // Score Calculation
      const raw = 170 - (sec1Val * 2 + sec2Val * 1.4);
      const center = clampScore(raw);
      const lowerScore = clampScore(center - 1.5);
      const upperScore = clampScore(center + 1.5);

      // Score Range
      const scoreRange = (lowerScore === upperScore)
        ? `${lowerScore}`
        : `${lowerScore}–${upperScore}`;

      // Percentiles
      const lowerPercent = getPercentile(lowerScore, quantData);
      const upperPercent = getPercentile(upperScore, quantData);

      // Score Circle
      const quantScoreText = document.getElementById('quantScoreText');
      if (sec1Val === 0 && sec2Val === 0) {
        quantScoreText.textContent = 'Perfect?';
      } else {
        quantScoreText.textContent = scoreRange;
      }

      // Percent Circle
      const quantPercentText = document.getElementById('quantPercentText');
      if (lowerPercent === upperPercent) {
        quantPercentText.textContent = `${lowerPercent}%`;
      } else {
        quantPercentText.textContent = `${lowerPercent}%–${upperPercent}%`;
      }

      // Inverted logic: how many made fewer mistakes
      const fewerLow = 100 - upperPercent;
      const fewerHigh = 100 - lowerPercent;

      // Bottom Message
      const quantMessage = document.getElementById('quantMessage');
      if (sec1Val === 0 && sec2Val === 0) {
        quantMessage.textContent = '';
      } else if (lowerPercent === upperPercent) {
        quantMessage.textContent =
          `Based on the inputs, understand that ${fewerLow}% of test takers make fewer mistakes than this in Quant.`;
      } else {
        quantMessage.textContent =
          `Based on the inputs, understand that ${fewerLow}% to ${fewerHigh}% of test takers make fewer mistakes than this in Quant.`;
      }
    }

    /* ============================
       Verbal Calculation
    ============================ */
    function calculateVerbal() {
      const sec1Val = parseFloat(document.getElementById('verbSec1').value);
      const sec2Val = parseFloat(document.getElementById('verbSec2').value);

      // Update displayed values
      document.getElementById('verbSec1Val').textContent = sec1Val;
      document.getElementById('verbSec2Val').textContent = sec2Val;

      // Score Calculation
      const raw = 170 - (sec1Val * 1.8 + sec2Val * 1.05);
      const center = clampScore(raw);
      const lowerScore = clampScore(center - 1.5);
      const upperScore = clampScore(center + 1.5);

      // Score Range
      const scoreRange = (lowerScore === upperScore)
        ? `${lowerScore}`
        : `${lowerScore}–${upperScore}`;

      // Percentiles
      const lowerPercent = getPercentile(lowerScore, verbalData);
      const upperPercent = getPercentile(upperScore, verbalData);

      // Score Circle
      const verbScoreText = document.getElementById('verbScoreText');
      if (sec1Val === 0 && sec2Val === 0) {
        verbScoreText.textContent = 'Perfect?';
      } else {
        verbScoreText.textContent = scoreRange;
      }

      // Percent Circle
      const verbPercentText = document.getElementById('verbPercentText');
      if (lowerPercent === upperPercent) {
        verbPercentText.textContent = `${lowerPercent}%`;
      } else {
        verbPercentText.textContent = `${lowerPercent}%–${upperPercent}%`;
      }

      // Inverted logic: how many made fewer mistakes
      const fewerLow = 100 - upperPercent;
      const fewerHigh = 100 - lowerPercent;

      // Bottom Message
      const verbMessage = document.getElementById('verbMessage');
      if (sec1Val === 0 && sec2Val === 0) {
        verbMessage.textContent = '';
      } else if (lowerPercent === upperPercent) {
        verbMessage.textContent =
          `Based on the inputs, understand that ${fewerLow}% of test takers make fewer mistakes than this in Verbal.`;
      } else {
        verbMessage.textContent =
          `Based on the inputs, understand that ${fewerLow}% to ${fewerHigh}% of test takers make fewer mistakes than this in Verbal.`;
      }
    }
  </script>
</body>
</html>
